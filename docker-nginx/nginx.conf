# # nginx.conf
# worker_processes  auto;
# events { worker_connections  1024; }

# http {
#     include       mime.types;
#     default_type  application/octet-stream;
#     sendfile        on;
#     keepalive_timeout  65;

#     server {
#         listen 5173;
#         server_name localhost;

#         root /var/www/html;
#         index index.html;

#         # serve generated HLS files
#         location /hls {
#             types {
#                 application/vnd.apple.mpegurl m3u8;
#                 video/mp2t ts;
#             }
#             add_header Cache-Control no-cache;
#             alias /var/www/hls;
#         }

#         location / {
#             try_files $uri $uri/ =404;
#         }
#     }
# }

# rtmp {
#     server {
#         listen 1935;
#         chunk_size 4096;

#         application live {
#             live on;
#             # disable recording on server
#             record off;

#             # HLS settings (creates /var/www/hls/<streamkey>.m3u8 and .ts segments)
#             hls on;
#             hls_path /var/www/hls;
#             hls_fragment 3;
#             hls_playlist_length 15;
#             # allow multiple viewers
#             hls_continuous on;

#             # optional: drop older segments automatically
#             # hls_cleanup on;
#         }
#     }
# }



worker_processes auto;

events {
    worker_connections 1024;
}

http {
    include mime.types;
    default_type application/octet-stream;
    sendfile on;
    keepalive_timeout 65;

    server {
        listen 8080;
        server_name localhost;

        # Serve static files (optional if you mount React build)
        root /var/www/html;
        index index.html;

        # Serve generated HLS files
        location /hls {
            types {
                application/vnd.apple.mpegurl m3u8;
                video/mp2t ts;
            }
            add_header Cache-Control no-cache;
            add_header Access-Control-Allow-Origin *;
            alias /var/www/hls;
        }

        location / {
            try_files $uri $uri/ =404;
        }
    }
}

rtmp {
    server {
        listen 1935;
        chunk_size 4096;

        application live {
            live on;
            record off;

            # HLS configuration
            hls on;
            hls_path /var/www/hls;
            hls_fragment 3;
            hls_playlist_length 15;
            hls_continuous on;
        }
    }
}

